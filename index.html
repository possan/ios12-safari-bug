<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body style="margin: 0; padding: 30px;">
        <div style="max-width: 400px;">
            <h1>iOS 12 Safari mp3 audio bug</h1>

            <p>
                We noticed a weird issue for a couple of our mp3 voice recordings, that
                it played the sound twice, and we tracked down the problem to only occur
                in Safari on iOS.
            </p>

            <p>
                Buggy mp3, plays twice:
            </p>

            <p>
                <audio class="media-document audio mac" id="a" controls download
                    src="buggy.mp3" type="audio/mpeg"></audio>
            </p>

            <p>
                Regular mp3, plays once:
            </p>

            <p>
                <audio class="media-document audio mac" id="d" controls download
                    src="working.mp3" type="audio/mpeg"></audio>
            </p>

            <p>
                <a href="https://github.com/possan/ios12-safari-bug/">GitHub repo</a>
            </p>

        </div>

        <script type="text/javascript">
            function addEventListeners(el, prefix) {
                var events = [
                    'abort',
                    'canplay',
                    'canplaythrough',
                    'durationchange',
                    'emptied',
                    'encrypted',
                    'ended',
                    'error',
                    'interruptbegin',
                    'interruptend',
                    'loadeddata',
                    'loadedmetadata',
                    'loadstart',
                    'mozaudioavailable',
                    'pause',
                    'play',
                    'playing',
                    'progress',
                    'ratechange',
                    'seeked',
                    'seeking',
                    'stalled',
                    'suspend',
                    'timeupdate',
                    'volumechange',
                    'waiting',
                ];
                events.forEach(event => {
                    el.addEventListener(event, arg => {
                    console.log(`${prefix}${event} - d=${el.duration}, p=${el.currentPosition}, s=${el.playing?'playing':'stopped'}`);
                    });
                })
            }

            addEventListeners(document.getElementById('a'), 'A: ');
            addEventListeners(document.getElementById('b'), 'B: ');
            addEventListeners(document.getElementById('c'), 'C: ');
            addEventListeners(document.getElementById('d'), 'D: ');

        </script>
    </body>
</html>

